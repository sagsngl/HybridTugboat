function [OP] = power_distribute_func(P_demand,r)
%% Parameters
percent = linspace(0, 50, 51) ./ 100;
index = length(percent);

%% Calculations
%load('MaxLimit.mat')

MaxLimit = ...
    [700.510204081633	293.525179856115
    719.642857142857	313.614006753781
    747.704081632653	319.288650712083
    777.040816326531	330.715019820878
    796.173469387755	342.170753193364
    812.755102040816	350.756129790046
    831.887755102041	359.334165320804
    857.397959183674	370.771546028484
    875.255102040816	385.108647775657
    891.836734693878	396.571722214065
    913.520408163265	410.897812362355
    937.755102040816	433.849654969902
    968.367346938775	453.905447070915
    991.326530612245	473.983262369696
    1013.01020408163	505.575539568345
    1033.41836734694	542.926882983409
    1050	577.411540155631
    1064.03061224490	603.270444868595
    1085.71428571429	643.495815592424
    1099.74489795918	675.110115988842
    1111.22448979592	709.609455292908
    1122.70408163265	744.108794596976
    1135.45918367347	775.726765526355
    1145.66326530612	815.985171046836
    1158.41836734694	847.603141976215
    1172.44897959184	893.605931581266
    1182.65306122449	925.231243576567
    1194.13265306122	959.730582880634
    1204.33673469388	1005.74438408457
    1214.54081632653	1066.14667449714
    1223.46938775510	1115.04184407576
    1231.12244897959	1163.94068418734
    1240.05102040816	1209.95815592424
    1248.97959183673	1247.34253413596
    1255.35714285714	1293.36734693878
    1263.01020408163	1330.75539568345
    1270.66326530612	1376.77653795331
    1279.59183673469	1425.67170753193
    1285.96938775510	1474.57421817648
    1291.07142857143	1511.96960798708
    1298.72448979592	1557.99075025694
    1314.03061224490	1563.70209954485
    1334.43877551020	1578.03186022610
    1353.57142857143	1583.73219791514
    1372.70408163265	1598.06562912935
    1394.38775510204	1612.39171927764
    1413.52040816327	1620.96975480840
    1431.37755102041	1635.30685655557
    1449.23469387755	1643.88856261929
    1470.91836734694	1663.97004845104
    1490.05102040816	1672.54808398179
    1510.45918367347	1689.75554250477
    1528.31632653061	1704.09264425195
    1544.89795918367	1718.43341653208
    1564.03061224490	1732.76684774629
    1580.61224489796	1744.22992218470
    1592.09183673469	1764.34077228014
    1603.57142857143	1764.30773748348
    1621.42857142857	1764.25635002202
    1640.56122448980	1767.07898986933
    1658.41836734694	1764.14990456614
    1676.27551020408	1764.09851710468
    1690.30612244898	1764.05814124211
    1706.88775510204	1766.88812215534
    1722.19387755102	1766.84407575980
    1741.32653061224	1766.78901776538
    1761.73469387755	1763.85259139627
    1778.31632653061	1766.68257230950
    1800	1766.62017324916];
%MaxLimit = array2table(MaxLimit);
%MaxLimit.Properties.VariableNames{1} = 'RPM';
%MaxLimit.Properties.VariableNames{2} = 'Pow_kW_';
OP = -1*[1,1,1,1];
rpm = r*5.213;
f_total_run = 100000000;
for i = 1:index
    p_ce_l = P_demand * percent(i);
    if p_ce_l > interp1(MaxLimit(:,1), MaxLimit(:,2), rpm)
        p_ce_l = interp1(MaxLimit(:,1), MaxLimit(:,2), rpm);
    end
    ce_l_f = fuel_con_map_Sagar(rpm,p_ce_l,0);

    p_ge_l = P_demand*0.5 - p_ce_l;
    if p_ge_l > 1095
        continue
    end
    %ge_l_f = fuel_con_map_Sagar(rpm,p_ge_l,1);

    for j = 1:index
        p_ce_r = P_demand * percent(i);
        if p_ce_r > interp1(MaxLimit(:,1), MaxLimit(:,2), rpm, 'pchip','extrap')
            p_ce_r = interp1(MaxLimit(:,1), MaxLimit(:,2), rpm, 'pchip','extrap');
        end
        ce_r_f = fuel_con_map_Sagar(rpm,p_ce_r,0);

        p_ge_r = P_demand*0.5 - p_ce_r;
        %ge_r_f = fuel_con_map_Sagar(rpm,p_ge_l,1);
        p_ge = p_ge_l + p_ge_r;
        if p_ge > 1095
            continue
        end
        ge_f = fuel_con_map_Sagar(rpm,p_ge,1);

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        f_total_inst = ce_l_f + ce_r_f + ge_f;
        if f_total_run > f_total_inst
            f_total_run = f_total_inst;
            OP = [p_ce_l, p_ce_r, p_ge_l, p_ge_r];
        end
        %                 X = X+1;
        %                 Y = X/(3.6518e+09);
        %                 waitbar(Y);

    end

end
if (((OP(1) == 0) && (OP(2) == 0)) && ((OP(3) ~= 0) || (OP(4) ~= 0)))
    OP(1:2) = [-1,-1];
elseif (((OP(3) == 0) && (OP(4) == 0)) && ((OP(1) ~= 0) || (OP(2) ~= 0)))
    OP(3:4) = [-1,-1];
elseif (OP == [0,0,0,0])
    OP(1:2) = [-1,-1];
end
end
