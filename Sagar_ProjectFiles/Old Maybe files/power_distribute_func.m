function [OP] = power_distribute_func(P_demand,r)
%% Parameters
percent = linspace(0, 50, 51) ./ 100;
index = length(percent);

%% Calculations
%load('MaxLimit.mat')

MaxLimit = ...
   [2.1951    294.39 
    10.976    300.46 
    26.341    312.59 
    41.707    312.59 
    63.659    312.59 
     81.22    324.73 
     94.39    327.77 
    109.76     330.8 
    129.51    336.87 
    155.85    349.01 
    186.59    355.08 
    210.73    367.22 
    241.46    376.33 
     267.8     382.4 
    291.95    385.43 
    305.12    394.54 
    324.88    406.68 
    353.41    418.82 
    381.95    433.99 
    412.68     443.1 
    441.22     452.2 
    458.78    464.34 
    476.34    473.44 
     493.9    488.62 
    515.85    506.83 
    529.02    528.07 
       540    543.25 
    555.37    558.42 
    575.12    576.63 
    594.88    600.91 
    603.66    616.08 
    623.41    640.36 
    638.78    670.71 
    658.54    688.92 
    671.71     713.2 
    680.49    728.38 
    689.27    743.55 
    702.44    761.76 
    715.61    798.18 
    737.56    837.63 
    761.71    864.95 
    772.68    898.33 
    783.66    922.61 
    799.02    952.96 
     812.2    980.27 
    820.98    998.48 
    831.95    1037.9 
    836.34    1071.3 
    845.12    1089.5 
     853.9    1113.8 
    860.49    1147.2 
    867.07    1177.5 
    875.85    1192.7 
    884.63      1217 
    891.22    1250.4 
     902.2    1274.7 
    910.98      1308 
    917.56    1341.4 
    928.54    1362.7 
    935.12      1390 
    939.51    1414.3 
     946.1    1444.6 
    954.88      1478 
    965.85    1496.2 
    968.05    1544.8 
    979.02    1559.9 
    1003.2      1569 
    1020.7    1575.1 
    1038.3    1581.2 
    1053.7    1587.3 
      1069    1590.3 
    1086.6    1596.4 
    1106.3    1608.5 
    1121.7    1611.5 
    1137.1    1614.6 
      1148    1617.6 
    1165.6    1626.7 
    1183.2    1635.8 
    1207.3      1648 
    1231.5      1651 
    1251.2    1666.2 
    1273.2    1672.2 
    1299.5    1684.4 
    1323.7    1693.5 
    1343.4    1702.6 
    1365.4    1714.7 
    1389.5    1729.9 
    1407.1    1732.9 
    1426.8    1748.1 
      1440    1754.2 
      1451    1763.3 
    1468.5    1769.3 
    1486.1    1769.3 
    1512.4    1772.4 
      1541    1772.4 
    1569.5    1775.4 
    1595.9    1769.3 
    1617.8    1769.3 
    1637.6    1769.3 
    1657.3    1772.4 
    1690.2    1772.4 
    1712.2    1772.4 
    1736.3    1772.4 
    1758.3    1772.4 
    1780.2    1772.4 
      1800    1772.4];
%MaxLimit = array2table(MaxLimit);
%MaxLimit.Properties.VariableNames{1} = 'RPM';
%MaxLimit.Properties.VariableNames{2} = 'Pow_kW_';
OP = [1,1,1,1];
rpm = r*5.213;
f_total_run = 100000000;
for i = 1:index
    p_ce_l = P_demand * percent(i);
    if p_ce_l > interp1(MaxLimit(:,1), MaxLimit(:,2), rpm)
        p_ce_l = interp1(MaxLimit(:,1), MaxLimit(:,2), rpm);
    end
    ce_l_f = fuel_con_map_Sagar(rpm,p_ce_l,0);

    p_ge_l = P_demand*0.5 - p_ce_l;
    %ge_l_f = fuel_con_map_Sagar(rpm,p_ge_l,1);

    for j = 1:index
        p_ce_r = P_demand * percent(i);
        if p_ce_r > interp1(MaxLimit(:,1), MaxLimit(:,2), rpm)
            p_ce_r = interp1(MaxLimit(:,1), MaxLimit(:,2), rpm);
        end
        ce_r_f = fuel_con_map_Sagar(rpm,p_ce_r,0);

        p_ge_r = P_demand*0.5 - p_ce_r;
        %ge_r_f = fuel_con_map_Sagar(rpm,p_ge_l,1);
        p_ge = p_ge_l + p_ge_r;
        if p_ge > 2500
            continue
        end
        ge_f = fuel_con_map_Sagar(rpm,p_ge,1);

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        f_total_inst = ce_l_f + ce_r_f + ge_f;
        if f_total_run > f_total_inst
            f_total_run = f_total_inst;
            OP = [p_ce_l, p_ce_r, p_ge_l, p_ge_r];
        end
        %                 X = X+1;
        %                 Y = X/(3.6518e+09);
        %                 waitbar(Y);

    end

end
if (((OP(1) == 0) && (OP(2) == 0)) && ((OP(3) ~= 0) || (OP(4) ~= 0)))
    OP(1:2) = [-1,-1];
elseif (((OP(3) == 0) && (OP(4) == 0)) && ((OP(1) ~= 0) || (OP(2) ~= 0)))
    OP(3:4) = [-1,-1];
elseif (OP == [0,0,0,0])
    OP(1:2) = [-1,-1];
end
end


% ge_r = P_demand * percent(idx_4);
